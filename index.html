<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/night-owl.css">
        <link rel="stylesheet" href="plugin/customStyles/highCodeBlocks.css">
        <link rel="stylesheet" href="plugin/customStyles/custom.css">
	</head>
	<body>

		<div class="reveal">
			<div class="slides">
				<section>
                    <h1>Yarn VS npm</h1>
                    <img src="./img/yarn_vs_npm.jpeg">
                </section>
                <section>
                    <p class="fragment fade-up">Расскажу про yarn</p>
                    <p class="fragment fade-up">Кое-что о node_modules</p>
                    <p class="fragment fade-up">Сравним yarn с npm</p>
                </section>
                <section>
                    <section>
                        <h3>Yarn</h3>
                        <img src="./img/yarn_logo.jpg">
                    </section>
                    <section>
                        <h3>Особенности</h3>
                    </section>
                    <section>
                        <p class="fragment fade-up">
                            <span class="yellow">yarn [install]</span>
                            - установка всех пакетов.
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">yarn add [package] [--dev]</span>
                            - добавить пакет.
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">yarn remove [package]</span>
                            - удалить пакет.
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">yarn global add [package]</span>
                            - установить пакет глобально.
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">yarn why [package]</span>
                            - вывести инфо, почему пакет в проекте.
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">yarn upgrade</span>
                            - удобный аналог rm -rf node_modules && npm install.
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">yarn audit</span>
                            - анализ зависимостей на уязвимости.
                        </p>
                    </section>
                    <section>
                        <img src="./img/rick_morty_meme.png">
                    </section>
                    <section>
                        <p class="fragment fade-up"><h3>Фичи</h3></p>
                        <p>
                            <span class="yellow">+ </span>
                            Selective resolutions - жестко заданная версия транзитивной зависимости.
                            <div>
                                <pre><code data-trim data-noescape>
                                    "resolutions": {
                                        "es5-ext": "1.0.53"
                                    }
                                </code></pre>
                            </div>
                        </p>
                    </section>
                    <section>
                        <p>
                            <span class="yellow">+ </span>
                            Workspaces - один локфайл/install на несколько проектов.
                            <div>
                                <pre><code data-trim data-noescape>
                                    {
                                        "private": true,
                                        "workspaces": ["workspace-a", "workspace-b"]
                                    }
                                </code></pre>
                                <pre><code data-trim data-noescape>
                                    {
                                        "name": "workspace-a",
                                        "version": "1.0.0",
                                      
                                        "dependencies": {
                                          "cross-env": "5.0.5"
                                        }
                                    }
                                </code></pre>
                            </div>
                        </p>
                    </section>
                    <section>
                        <span class="yellow">+ </span>
                        Merging lockfiles - одной командой.
                        <div>
                            <pre><code data-trim data-noescape>
                                $ yarn install

                                yarn install v1.0.1
                                info Merge conflict detected in yarn.lock and successfully merged.
                                [1/4] Resolving packages...
                            </code></pre>
                        </div>
                    </section>
                    <section>
                        <span class="yellow">+ </span>
                        Возможность запускать бинарники из node_modules/.bin из коробки.
                        <div>
                            <pre><code data-trim data-noescape>
                                $ yarn elsint
                            </code></pre>
                        </div>
                        Npm с 5 версии использует <span class="yellow">npx</span>, который обладает рядом преимуществ:
                        <div>
                            <pre><code data-trim data-noescape>
                                $ npx create-react-app
                            </code></pre>
                        </div>
                        <div>
                            <pre><code data-trim data-noescape>
                                $ npx -p node@6 myscript.js
                            </code></pre>
                        </div>
                    </section>
                    <section>
                        <p class="fragment fade-up">
                            <span class="yellow">+ </span>
                            yarn upgrade-interactive.
                        </p>
                        <p><img src="./img/yarn_upgrade_interactive.jpg" /></p>
                    </section>
                    <section>
                        <p class="fragment fade-up">
                            <span class="yellow">+ </span>
                            Безопасный.
                        </p>
                        <div>
                            <pre><code data-trim data-noescape>
                                "license": "MIT",
                                "main": "index.js",
                                "name": "core-js",
                                "repository": {
                                  "type": "git",
                                  "url": "git+https://github.com/zloirock/core-js.git",
                                  "directory": "packages/core-js"
                                },
                                "scripts": {
                                  "postinstall": "node -e \"try{require('./postinstall')}catch(e){}\""
                                },
                            </code></pre>
                        </div>
                        <p class="fragment fade-up">
                            <span class="yellow">.yarnrc</span> ---> enableScripts: false
                        </p>
                    </section>
                    <section>
                        <p class="fragment fade-up">
                            <span class="yellow">+ </span>
                            Был написан в Meta Platform, но уже давно стал полностью опенсорсным.
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">+ </span>
                            Публичный чат (Discord), понятный состав команды
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">+ </span>
                            Вовлеченность коммьюнити. Больше всего контрибьюторов - 48. У npm - 24.
                        </p>
                    </section>
                    <section>
                        <p class="fragment fade-up"><h3>Минусы</h3></p>
                        <p class="fragment fade-up">
                            <span class="yellow">- </span>
                            Реклама Meta Platforms и склонение в экосистему, пиар.
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">- </span>
                            Yarn v.1 де-факто мертвый.
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">- </span>
                            Зачастую фичи очень редко используются, так что могут быть отброшены по принципу YAGNI или KISS.
                        </p>
                    </section>
                    <section>
                        <p class="fragment fade-up">
                            <span class="yellow">- </span>
                            Не является стандартом (не поставляется с Node js в отл. от npm)
                        </p>
                        <p class="fragment fade-up">
                            <span class="yellow">- </span>
                            Нет больших бюджетов на разработку в отл. от npm (Microsoft).
                    </section>
                </section>
                <section>
                    <section>
                        <h3>Бенчмарки</h3>
                        <img src="./img/dog_meme.png">
                    </section>
                    <section>
                        <p class="fragment fade-up"><h3>Хайп</h3></p>
                        <p class="fragment fade-up"><img src="./img/usage_stat.jpg"></p>
                    </section>
                    <section>
                        <p><h3>Репозитории на GH</h3></p>
                        <h5>Yarn</h5>
                        <p><img src="./img/yarn_repo.png"></p>
                        <h5>npm</h5>
                        <p><img src="./img/npm_repo.png"></p>
                    </section>
                    <section>
                        <p class="fragment fade-up"><h3>Скорость</h3></p>
                        <h5>Установка зависимостей в маленькое приложение.</h5>
                        <p class="fragment fade-up"><img src="./img/speed_comparsion_small_app.jpg" /></p>
                    </section>
                    <section>
                        <h5>Установка зависимостей в приложение среднего размера.</h5>
                        <p class="fragment fade-up"><img src="./img/speed_comparsion_middle_app.jpg" /></p>
                    </section>
                    <section>
                        <p class="fragment fade-up">
                            <a rel="stylesheet" href="https://p.datadoghq.eu/sb/d2wdprp9uki7gfks-c562c42f4dfd0ade4885690fa719c818?tpl_var_npm=%2A&tpl_var_pnpm=no&tpl_var_yarn-classic=%2A&tpl_var_yarn-modern=no&tpl_var_yarn-nm=no&tpl_var_yarn-pnpm=no&from_ts=1648174291290&to_ts=1648779091290&live=true">
                                Бенчмарк от Yarn
                            </a>
                        </p>
                        <p class="fragment fade-up"><h3>Медленнее !== медленно</h3></p>
                    </section>
                </section>
                <section>
                    <h3>Локфайлы</h3>
                    <p style="height: 400px" class="fragment fade-up"><img src="./img/locked.jpg" /></p>
                    <p class="fragment fade-up">package-lock.json</p>
                    <p class="fragment fade-up">yarn.lock</p>
                </section>
                <section>
                    <section>
                        <h3>Node Semver</h3>
                        <img src="./img/node_semver.png">
                    </section>
                    <section>
                        <h3>Еще немного о Nodejs semver</h3>
                        <p class="fragment fade-up">
                            <h5><strong>*</strong> - Звездочки - <span class="yellow">1.2.*</span> (>=1.2.0 < 1.3.0)</h5>
                            <h5><strong>~</strong> - Тильды - <span class="yellow">~1.2.3</span> (>=1.2.3 < 1.3.0)</h5>
                            <h5><strong>^</strong> - Крышечки - <span class="yellow">^0.2.3</span> (>=0.2.3 < 0.3.0)</h5>
                        </p>
                    </section>
                </section>
                <section>
                    <section>
                        <h3>yarn.lock</h3>
                        <div>
                            <pre><code data-trim data-noescape>
                              "@babel/code-frame@7.10.4":
                                version "7.10.4"
                                resolved "https://registry.yarnpkg.com/@babel/code-frame/-/code-frame-7.10.4.tgz#168da1a36e90da68ae8d49c0f1b48c7c6249213a"
                                integrity sha512-vG6SvB6oYEhvgisZNFRmRCUkLz11c7rp+tbNTynGqc6mS1d5ATd/sGyV6W0KZZnXRKMTzZDRgQT3Ou9jhpAfUg==
                                dependencies:
                                  "@babel/highlight" "^7.10.4"
                              
                              "@babel/code-frame@7.12.11":
                                version "7.12.11"
                                resolved "https://registry.yarnpkg.com/@babel/code-frame/-/code-frame-7.12.11.tgz#f4ad435aa263db935b8f10f2c552d23fb716a63f"
                                integrity sha512-Zt1yodBx1UcyiePMSkWnU4hPqhwq7hGi2nFL1LeA3EUl+q2LQx16MISgJ0+z7dnmgvP9QtIleuETGOiOH1RcIw==
                                dependencies:
                                  "@babel/highlight" "^7.10.4"
                            </code></pre>
                        </div>
                    </section>
                    <section>
                        <h3>package-lock.json</h3>
                        <div>
                            <pre><code data-trim data-noescape>
                                  "dependencies": {
                                    "@babel/code-frame": {
                                      "version": "7.12.13",
                                      "resolved": "https://registry.npmjs.org/@babel/code-frame/-/code-frame-7.12.13.tgz",
                                      "integrity": "sha512-HV1Cm0Q3ZrpCR93tkWOYiuYIgLxZXZFVG2VgK+MBWjUqZTundupbfx2aXarXuw5Ko5aMcjtJgbSs4vUGBS5v6g==",
                                      "dev": true,
                                      "requires": {
                                        "@babel/highlight": "^7.12.13"
                                      }
                                    },
                                    "@babel/compat-data": {
                                      "version": "7.14.0",
                                      "resolved": "https://registry.npmjs.org/@babel/compat-data/-/compat-data-7.14.0.tgz",
                                      "integrity": "sha512-vu9V3uMM/1o5Hl5OekMUowo3FqXLJSw+s+66nt0fSWVWTtmosdzn45JHOB3cPtZoe6CTBDzvSw0RdOY85Q37+Q==",
                                      "dev": true,
                                      "dependencies": {
                                        ...
                                      }
                                    }
                            </code></pre>
                        </div>
                    </section>
                    <section>
                        <p class="fragment fade-up"><h3>npm-srinkwrap.json</h3></p>
                        <p class="fragment fade-up">Приоритет над package-lock.json</p>
                        <p class="fragment fade-up">Публикуется командой npm pack/ npm publish</p>
                        <p class="fragment fade-up">
                            <img src="./img/shrinkwrap_create.png">
                        </p>
                    </section>
                </section>
                <section>
                    <section>
                        <h3>Как работают node_modules</h3>
                        <img src="./img/node-modules-meme.png" alt="" style="height:600px">
                    </section>
                    <section>
                        <h3>Резолвим пакет node_modules</h3>
                        <div style="display:flex;flex-direction:column;align-items:flex-start">
                            <p class="fragment fade-up">
                                По относительному пути: <span class="yellow">'./*'</span>, <span class="yellow">'../*'</span>
                            </p>
                            <p class="fragment fade-up">
                                От рута: <span class="yellow">'/*'</span>
                            </p>
                            <p class="fragment fade-up">
                                Из ядра Nodejs: <span class="yellow">ms(Date.now() - dumpStartTime))</span>
                            </p>
                            <p class="fragment fade-up">
                                Абсолютный импорт: <span class="yellow">require('react')</span>
                            </p>
                        </div>
                    </section>
                    <section>
                        <h3>Абсолютный импорт</h3>
                        <p class="fragment fade-up">
                            Ищем папку node_modules
                        </p>
                        <p class="fragment fade-up">
                            node_modules есть <span class="yellow"> ? </span>пытаемся зарезолвить<span class="yellow"> : </span>идем на уровень выше
                        </p>
                    </section>
                    <section>
                        <p>
                            <img src="./img/npm_v2.png" alt="">
                        </p>
                        <p class="fragment fade-up"><span class="yellow">- </span>Нет переиспользования пакетов</p>
                    </section>
                    <section>
                        <p class="fragment fade-up" style="margin-bottom:0;padding-bottom:0">
                            <img src="./img/npm_v3.png" alt="">
                        </p>
                        <p class="fragment fade-up">
                            <img src="./img/npm_v3_update_first.png" alt="">
                        </p>
                    </section>
                    <section>
                        <p class="fragment fade-up">
                            <img src="./img/npm_v3_update.png" alt="">
                        </p>
                        <p class="fragment fade-up"><span class="yellow">- </span>Потенциальные баги!</p>
                    </section>
                    <section>
                        <p class="fragment fade-up" style="margin-bottom:0;padding-bottom:0">
                            <img src="./img/npm_v3_danger_pre.png" alt="">
                        </p>
                        <p class="fragment fade-up">
                            <img src="./img/npm_v3_danger.png" alt="">
                        </p>
                    </section>
                    <section>
                        <h3>Детерминированная структура node_modules</h3>
                        <p>
                            <span class="yellow">Yarn</span> - в пределах одной версии (1, 2 или 3).
                        </p>
                        <p>
                            <span class="yellow">Npm 5+</span> - кроссверсионно.
                        </p>
                    </section>
                </section>
                <section>
                    <section>
                        <h3>Выводы</h3>
                        <div style="display:flex;flex-direction:column;align-items:flex-start">
                            <p>
                                Обе технологии широко распространены и имеют сильное коммьюнити.
                            </p>
                            <p>
                                Явного лидера нет. Npm чуть проще и доступнее, но ни в чем не является лидером.
                            </p>
                            <p>
                                Yarn - первопроходец. Npm только сейчас догоняет yarn v.1.*.
                            </p>
                            <p>
                                В среде React (и его экосистемы) гораздо более распространен Yarn.
                            </p>
                        </div>
                    </section>
                    <section>
                        Спасибо за внимание!
                    </section>
                </section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			Reveal.initialize({
				hash: true,
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
            Reveal.addEventListener( 'slidechanged', function( event ) {
                Reveal.nextFragment();
            });
		</script>
	</body>
</html>
